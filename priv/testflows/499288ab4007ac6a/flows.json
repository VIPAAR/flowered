[{"id":"499288ab4007ac6a","type":"tab","label":"[.heroku-red-erik] page content","disabled":false,"info":"This is one part of the flows that define [Red-Erik](https://red-erik.org).","env":[{"name":"ERED_PENDING","value":"true","type":"bool"},{"name":"ERED_TIMEOUT","value":"1","type":"num"}]},{"id":"2b535674bcb150f5","type":"group","z":"499288ab4007ac6a","name":"flow page content","style":{"label":true},"nodes":["ad441e55371ca185","bfcbdb827fdad90d","e86d82cea39da84c","b3f263c5422213e0","e6d36a7dcd160db6","b5cb637561aec452","f4b7820a791c3781","7c322cb8d6c84f44","292877794e2e4c7f"],"x":187.5,"y":961,"w":1166,"h":228},{"id":"2ec5e89689f4d7bc","type":"group","z":"499288ab4007ac6a","name":"incoming requests","style":{"label":true},"nodes":["e269f7c54cd8fbdb","c9f4038b3a091911","a62c005be1c00279"],"x":128,"y":274,"w":123,"h":411},{"id":"3e4711cebb640a86","type":"template","z":"499288ab4007ac6a","name":"index page content","field":"payload","fieldType":"msg","format":"markdown","syntax":"plain","template":"## Hi There,\n\nRed Erik is the test pattern page for testing [Erlang-RED](https://github.com/gorenje/erlang-red): *visual low-code flow based programming for Erlang* inspired by [NodeRED](https://nodered.org).\n\nRed Erik consists of a colletion of flows that describe/define/code how this website works. The entire content of this sites is stored [flow files](flows). In a way, that makes Red Erik a static website defined using flow based programming being executed on the [BEAM](https://en.wikipedia.org/wiki/BEAM_(Erlang_virtual_machine)).\n\nThanks to [@mwmiller](https://github.com/mwmiller), Erlang-RED is also hosted at [fly.io](https://ered.fly.dev/node-red) and can be tried out there.\n\nThis site is hosted at [heroku](https://github.com/gorenje/erlang-red/blob/main/Dockerfile.heroku) and has no flow editor frontend. \n\nErlang-RED consists of a flow editor to create flows and a compute engine to execute flows. It is possible to just run the execute engine with a collection of interlinked flows. As is the case here.\n\nFor more details on the project, the so-far completed [milestones](milestones).\n\n","output":"str","x":499,"y":312,"wires":[["0a62c8bf030e0b9c"]]},{"id":"37bb607de230a96e","type":"http response","z":"499288ab4007ac6a","name":"","statusCode":"","headers":{},"x":1519,"y":204,"wires":[]},{"id":"bf2288d1d9116c8c","type":"http response","z":"499288ab4007ac6a","name":"redirect to /","statusCode":"301","headers":{"location":"/"},"x":912,"y":814,"wires":[]},{"id":"0925bd2682e7adf6","type":"file in","z":"499288ab4007ac6a","name":"","filename":"priv/MILESTONES.md","filenameType":"str","format":"utf8","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":749,"y":365.5,"wires":[["72f45a66491c6cf8"]]},{"id":"af700dc5f2661b3f","type":"switch","z":"499288ab4007ac6a","name":"routing by path","property":"req.params.path","propertyType":"msg","rules":[{"t":"eq","v":"milestones","vt":"str"},{"t":"eq","v":"flows","vt":"str"},{"t":"eq","v":".images","vt":"str"},{"t":"eq","v":"js","vt":"str"},{"t":"eq","v":"css","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":6,"x":462,"y":576,"wires":[["0925bd2682e7adf6","b8dadb711ed64a47"],["e5d65633d4d67375"],["4f16116913c3f7e7"],["6a0176fb7df5f036"],["8fd7a83d352def61"],["bf2288d1d9116c8c","0c7e2402d15c6874"]]},{"id":"72f45a66491c6cf8","type":"markdown","z":"499288ab4007ac6a","name":"","x":978,"y":184,"wires":[["21523010fc7adf2b"]]},{"id":"b8dadb711ed64a47","type":"debug","z":"499288ab4007ac6a","name":"debug 4","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":949,"y":431,"wires":[]},{"id":"21523010fc7adf2b","type":"template","z":"499288ab4007ac6a","name":"HTML Layout","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html lang=\"{{ page.lang | default: site.lang | default: \"en\" }}\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <!-- <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"> -->\n    \n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\n    <title>Red Erik</title>\n\n    <meta name=\"generator\" content=\"Erlang-RED v.0.0.0-beta0\" />\n    <meta property=\"og:title\" content=\"{{{ page.title }}} | {{ blogdetails.title }}\" />\n    <meta property=\"og:description\" content=\"{{{ page.summary }}}\" />\n    <meta property=\"og:locale\" content=\"en_AU\" />\n    <meta property=\"og:url\" content=\"{{{ blogdetails.url }}}{{{ blogdetails.path_prefix }}}/{{ page.path }}\" />\n    <meta property=\"og:site_name\" content=\"{{{ blogdetails.url }}}\" />\n    <meta name=\"giscus:backlink\" content=\"{{{ blogdetails.url }}}{{{ blogdetails.path_prefix }}}/{{ page.path }}\">\n\n    {{#page.image}}\n    <meta property=\"og:image\" content=\"{{{ blogdetails.cdn_url }}}/content/{{{ page.image }}}\" />\n    {{/page.image}}\n\n    <link rel=\"canonical\" href=\"{{{ blogdetails.url }}}{{{ blogdetails.path_prefix }}}/{{ page.path }}\" />\n    <meta name=\"twitter:card\" content=\"{{{ blogdetails.url }}}{{{ blogdetails.path_prefix }}}/{{ page.path }}\" />\n    <meta property=\"twitter:title\" content=\"{{ page.title }}\" />\n\n    <link rel=\"alternate\" type=\"application/rss+xml\" href=\"/feed.xml\" title=\"Subscribe to Blog Open Mind Map Org\">\n    <link rel=\"sitemap\" type=\"application/xml\" title=\"Sitemap\" href=\"/sitemap.xml\">\n\n    <link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"{{{ blogdetails.cdn_url }}}/content/apple-touch-icon.png\">\n    <link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"{{{ blogdetails.cdn_url }}}/content/favicon-32x32.png\">\n    <link rel=\"icon\" type=\"image/png\" sizes=\"16x16\" href=\"{{{ blogdetails.cdn_url }}}/content/favicon-16x16.png\">\n\n    <link rel=\"stylesheet\" href=\"/css/style.css\">\n  </head>\n\n  <body>\n    <div id=\"root\">\n      <div class=\"quattro\">\n    <header>\n      <center>Red Erik</center>\n    </header>\n    \n       {{{ payload }}}\n\n{{^no_footer}}\n    <div class='footer-div'>\n      <span>\n    <a href=\"/\">Home</a>\n    </span>\n    </div>\n{{/no_footer}}\n\n      </div>\n    </div>\n  </body>\n</html>\n","output":"str","x":1170,"y":206,"wires":[["37bb607de230a96e"]]},{"id":"2c602b4ea08f4f08","type":"debug","z":"499288ab4007ac6a","name":"debug 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":493,"y":378,"wires":[]},{"id":"736b76c7db9b3479","type":"debug","z":"499288ab4007ac6a","name":"debug 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":497,"y":762,"wires":[]},{"id":"4f16116913c3f7e7","type":"link out","z":"499288ab4007ac6a","name":"image server","mode":"link","links":["93ac67a764f0fee5"],"x":1354,"y":543,"wires":[]},{"id":"e269f7c54cd8fbdb","type":"link in","z":"499288ab4007ac6a","g":"2ec5e89689f4d7bc","name":"[route] /","links":[],"x":169,"y":315,"wires":[["3e4711cebb640a86"]]},{"id":"c9f4038b3a091911","type":"link in","z":"499288ab4007ac6a","g":"2ec5e89689f4d7bc","name":"[route] /:path/:path2/[...]","links":[],"x":169,"y":499,"wires":[["2c602b4ea08f4f08","af700dc5f2661b3f"]]},{"id":"a62c005be1c00279","type":"link in","z":"499288ab4007ac6a","g":"2ec5e89689f4d7bc","name":"[route] /:path/[...]","links":[],"x":169,"y":644,"wires":[["af700dc5f2661b3f","736b76c7db9b3479"]]},{"id":"6a0176fb7df5f036","type":"link out","z":"499288ab4007ac6a","name":"js content","mode":"link","links":["21f027942e0a487d"],"x":1415,"y":567.5,"wires":[]},{"id":"0c7e2402d15c6874","type":"debug","z":"499288ab4007ac6a","name":"debug 3","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":958,"y":690,"wires":[]},{"id":"8fd7a83d352def61","type":"link out","z":"499288ab4007ac6a","name":"css content","mode":"link","links":["5c3a9b7988cab5e6"],"x":1354,"y":595.5,"wires":[]},{"id":"ad441e55371ca185","type":"file in","z":"499288ab4007ac6a","g":"2b535674bcb150f5","name":"","filename":"filename","filenameType":"msg","format":"utf8","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":688,"y":1058.5,"wires":[["e6d36a7dcd160db6"]]},{"id":"bfcbdb827fdad90d","type":"change","z":"499288ab4007ac6a","g":"2b535674bcb150f5","name":"","rules":[{"p":"flowids","pt":"msg","t":"set","to":"[\"499288ab4007ac6a\",\"777bee1d06741240\", \"9d3f5506aa810b22\"]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":406,"y":1146,"wires":[["e86d82cea39da84c"]]},{"id":"e86d82cea39da84c","type":"split","z":"499288ab4007ac6a","g":"2b535674bcb150f5","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","property":"flowids","x":498,"y":1081.5,"wires":[["b3f263c5422213e0"]]},{"id":"b3f263c5422213e0","type":"change","z":"499288ab4007ac6a","g":"2b535674bcb150f5","name":"","rules":[{"p":"filename","pt":"msg","t":"set","to":"\"priv/testflows/\" & $$.payload & \"/flows.json\"","tot":"jsonata"},{"p":"flowid","pt":"msg","t":"set","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":574,"y":1002,"wires":[["ad441e55371ca185"]]},{"id":"e6d36a7dcd160db6","type":"join","z":"499288ab4007ac6a","g":"2b535674bcb150f5","name":"","mode":"custom","build":"array","property":"","propertyType":"full","key":"topic","joiner":"\\n","joinerType":"str","useparts":false,"accumulate":false,"timeout":"","count":"3","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":808,"y":1119,"wires":[["b5cb637561aec452"]]},{"id":"b5cb637561aec452","type":"function","z":"499288ab4007ac6a","g":"2b535674bcb150f5","name":"semi automated content lifting","func":"%% Need to do this because bbmustache does not support arrays or \n%% nested keys, i.e., with proper mustache, I won't need this and \n%% instead would use {{ payload.0.payload }} to obtain the flow data.\n\n%%\n%% There are three flows at the time of writing, need to extend\n%% that assumptions if a fourth flow is added.\n%%\n\nTmp = fun (Ary,Msg) ->\n      [Head | Tail] = Ary,\n      Key = list_to_binary(io_lib:format( \"flow_id_~s\", [ maps:get(flowid, Head) ])),\n      {Tail, maps:put(Key, maps:get(payload, Head), Msg)}\n   end,\n\n\n{T, Msg2} = Tmp(maps:get(payload, Msg), Msg),\n{T2, Msg3} = Tmp(T, Msg2),\n{T3, Msg4} = Tmp(T2, Msg3),\n\nMsg4\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1050,"y":1148,"wires":[["f4b7820a791c3781"]]},{"id":"f4b7820a791c3781","type":"template","z":"499288ab4007ac6a","g":"2b535674bcb150f5","name":"inline rendering of flows","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n\n    <title>Erlang-RED Flows For Red-Erik.org</title>\n\n    <script src=\"/js/d3.min.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n    <script src=\"/js/jquery.min.3.7.0.js\" integrity=\"sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n    <script src=\"/js/flowviewer.js\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\"></script>\n    <link rel=\"stylesheet\" href=\"/css/flowviewer.css\">\n    <link rel=\"stylesheet\" href=\"/css/style.css\">\n  </head>\n\n  <body>\n        <div id=\"root\">\n      <div class=\"quattro\">\n    <header>\n      <center>Red Erik Flow Code</center>\n      <hr/>\n    </header>\n\n<p>\n     Visualisation of the flows done with the <a href=\"https://github.com/gorenje/node-red-flowviewer-js\">flowviewer.js</a> library. Since flows are 100% compatible with Node-RED flows, the same tooling can be used.\n</p>\n\n<p>\n    Red Erik consists of three flows (at time of writing) and each flow is presented here as an SVG image. The original flow code is JSON and stored in the <a href=\"https://github.com/gorenje/erlang-red/tree/main/priv/testflows\">project repository</a>. Each flow can also be viewed in Node-RED and Erlang-RED and links are provided for reference.\n</p>\n\n    <h3>Router Flow</h3>\n\n<p>\n    This flow defines th http in nodes that receive web requests. All the router flow does is pass those requests onto the pages flow using link-out nodes.\n</p>\n\n<pre><code class=\"language-noderedjson\">{{ flow_id_9d3f5506aa810b22  }}</code></pre>\n\n<p>\n    Flow viewed in <a href='https://flowhub.org/f/9d3f5506aa810b22/ib'>Node-RED</a> or <a href=\"https://ered.fly.dev/node-red?tstid=9d3f5506aa810b22\">Erlang-RED</a>, as <a href=\"https://flowhub.org/f/9d3f5506aa810b22\">UML</a> or <a href='https://github.com/gorenje/erlang-red/blob/main/priv/testflows/9d3f5506aa810b22/flows.json'>JSON</a>.\n</p>\n\n\n    <h3>Pages Flow</h3>\n\n<p>\n  Pages content is contained in this flow. This text along with the flow data are all stored in this flow. If a path is not known, the response to the requset is 404. Requests for asset content (i.e. image, javascript or CSS) are passed onto the asset flow.\n</p>\n\n<pre><code class=\"language-noderedjson\">{{ flow_id_499288ab4007ac6a  }}</code></pre>\n\n<p>\n    Flow viewed in <a href='https://flowhub.org/f/499288ab4007ac6a/ib'>Node-RED</a> or <a href=\"https://ered.fly.dev/node-red?tstid=499288ab4007ac6a\">Erlang-RED</a>, as <a href=\"https://flowhub.org/f/499288ab4007ac6a\">UML</a> or <a href='https://github.com/gorenje/erlang-red/blob/main/priv/testflows/499288ab4007ac6a/flows.json'>JSON</a>.\n</p>\n\n    <h3>Asset Flow</h3>\n\n<p>\n  Retrieve assets such as javascript or css from disk. Only valid paths are accepted and anything that is not known will receive an 404 response.\n</p>\n\n<pre><code class=\"language-noderedjson\">{{ flow_id_777bee1d06741240  }}</code></pre>\n    \n<p>\n    Flow viewed in <a href='https://flowhub.org/f/777bee1d06741240/ib'>Node-RED</a> or <a href=\"https://ered.fly.dev/node-red?tstid=777bee1d06741240\">Erlang-RED</a>, as <a href=\"https://flowhub.org/f/777bee1d06741240\">UML</a> or <a href='https://github.com/gorenje/erlang-red/blob/main/priv/testflows/777bee1d06741240/flows.json'>JSON</a>.\n</p>\n\n\n    <div class='footer-div'>\n      <span>\n    <a href=\"/\">Home</a>\n    </span>\n    </div>\n</div></div>\n  </body>\n\n  <script>\n    $(function(){\n      replaceCodeBlocksWithNodeRedFlowImages();\n    });\n    window.addEventListener('load', function () {\n        setTimeout( function(){\n          var svgs = d3.selectAll(\".svg-container-noderedjson svg\");\n          svgs.each(function() {\n            var svg = d3.select(this);\n            \n            svg.html(\"<g>\" + svg.html() + \"</g>\");\n            var inner = svg.select(\"g\");\n            var zoom = d3.zoom().on(\"zoom\", function(event) {\n              inner.attr(\"transform\", event.transform);\n            });\n            svg.call(zoom);\n          });\n        }, 500);\n      });\n  </script>\n</html>","output":"str","x":1086.5,"y":1056,"wires":[["292877794e2e4c7f"]]},{"id":"7c322cb8d6c84f44","type":"link in","z":"499288ab4007ac6a","g":"2b535674bcb150f5","name":"flow template","links":[],"x":228.5,"y":1028,"wires":[["bfcbdb827fdad90d"]]},{"id":"292877794e2e4c7f","type":"link out","z":"499288ab4007ac6a","g":"2b535674bcb150f5","name":"link out 2","mode":"return","links":[],"x":1312.5,"y":1055,"wires":[]},{"id":"e5d65633d4d67375","type":"link call","z":"499288ab4007ac6a","name":"flow page content","links":["7c322cb8d6c84f44"],"linkType":"static","timeout":"30","x":1231,"y":475,"wires":[["37bb607de230a96e"]]},{"id":"0a62c8bf030e0b9c","type":"change","z":"499288ab4007ac6a","name":"","rules":[{"p":"no_footer","pt":"msg","t":"set","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":718,"y":184,"wires":[["72f45a66491c6cf8"]]}]